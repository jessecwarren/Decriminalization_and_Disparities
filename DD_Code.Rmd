---
title: "DD_Code"
author: "Jesse Warren"
date: "10/20/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
```


```{r load UCR data}
#loop to load data
UCR_files <- list.files("Data/UCR", pattern = ".tsv$", recursive = TRUE)
UCR_files <- UCR_files[-which(str_detect(UCR_files, "UCR_2015"))] #remove 2015, because it doesnt have yearly summarized data, and needs to be dealt with separately
UCR_data_list <- vector("list", length(UCR_files))
UCR_data_names <- stringr::str_sub(UCR_files, 1, 8)
names(UCR_data_list) <- UCR_data_names
for (i in seq_along(UCR_files)){
  UCR_data_list[[UCR_data_names[i]]] <- read_tsv(paste0("Data/UCR/", UCR_files[i]))
}
head(UCR_data_list[[1]])

#check that colnames are the same
colnames(UCR_data_list[[1]]) == colnames(UCR_data_list[[2]])


#load 2015 separately, calculate



```

```{r calculate statewide arrest totals}

#calculate % of total arrests that are african american, white
UCR_data_list$UCR_2016 %>% 
  group_by(STNAME) %>% 
  filter(OFFENSE != 998, OFFENSE != 000) %>% 
  summarize(total_arrests_race_data = (sum(AW) + sum(AB) + sum(AI) + sum(AA) + sum(JW) + sum(JB) + sum(JI) + sum(JA)),
            pct_African_American_arrests = (sum(AB) + sum(JB)) / (sum(AW) + sum(AB) + sum(AI) + sum(AA) + sum(JW) + sum(JB) + sum(JI) + sum(JA)),
            pct_White_arrests = (sum(AW)+ sum(JW)) / (sum(AW) + sum(AB) + sum(AI) + sum(AA) + sum(JW) + sum(JB) + sum(JI) + sum(JA)))


#calculate % of marijuana arrests that are african american, white
UCR_data_list$UCR_2016 %>% 
  group_by(STNAME) %>% 
  filter(OFFENSE == 182 | OFFENSE == 187) %>%  #only include marijuana sale (182) or marijuana possession (187) 
  summarize(total_marijuana_arrests_race_data = (sum(AW) + sum(AB) + sum(AI) + sum(AA) + sum(JW) + sum(JB) + sum(JI) + sum(JA)),
            pct_African_American_marijuana_arrests = (sum(AB) + sum(JB)) / (sum(AW) + sum(AB) + sum(AI) + sum(AA) + sum(JW) + sum(JB) + sum(JI) + sum(JA)),
            pct_White_marijuana_arrests = (sum(AW) + sum(JW)) / (sum(AW) + sum(AB) + sum(AI) + sum(AA) + sum(JW) + sum(JB) + sum(JI) + sum(JA)))
  
```



```{r Look at UCR Marijuana data}


UCR_Data_2013_WA_clean <- UCR_Data_2013_raw %>% 
  select(STATE, ORI, YEAR, REPORT, ADJUST, POP, COUNTY, AGENCY, CARD1, CARD2, CARD3, OFFENSE, JW, JB, JI, JA, JH, JN, AW, AB, AI, AA, AH, AN) %>% 
  filter(STATE == "(46) Washington") %>% #only include WA
  filter(OFFENSE == 182 | OFFENSE == 187) #only include marijuana sale (182) or marijuana possession (187)
  
UCR_Data_2013_AK_clean <- UCR_Data_2013_raw %>% 
  select(STATE, ORI, YEAR, REPORT, ADJUST, POP, COUNTY, AGENCY, CARD1, CARD2, CARD3, OFFENSE, JW, JB, JI, JA, JH, JN, AW, AB, AI, AA, AH, AN) %>% 
  filter(STATE == "(50) Alaska") %>% #only include AK
  filter(OFFENSE == 182 | OFFENSE == 187) #only include marijuana sale (182) or marijuana possession (187)  
  

#summarize number of marijuana arrests in AK

table(UCR_Data_2013_AK_clean$AB)
```

